---
subject: Ruby agent
releaseDate: '2017-07-24'
version: 4.3.0
---

## v4.3.0

* Instrumentation for the Bunny AMQP Client

  The Bunny AMQP Client is now automatically instrumented. The agent will report data for messages sent and received by an application. Data on messages is available in both APM and Insights. Applications connected through a RabbitMQ exchange will now also be visible on Service Maps as part of Cross Application Tracing. See the [message queues documentation page](https://docs.newrelic.com/docs/agents/ruby-agent/features/message-queues) for more details.
* Safely normalize external hostnames

  The agent has been updated to check for nil host values before downcasing the hostname. Thanks Rafael Valério for the contribution!
* PageView events will not be generated for ignored transactions

  The agent now checks if transaction is ignored before injecting the New Relic Browser Agent. This will prevent PageView events from being generated for ignored transactions.
* Datastores required explicitly in agent

  The agent has been modified to explicity `require` the Datastores module whereas previously there were situations where the module could be implicitly defined. Thanks Kevin Griffin for the contribution!
* Clear transaction state after forking

  Previously, if a transaction was started and the process forks, the transaction state survived the fork and `#after_fork` call in thread local storage. Now, this state is cleared by `#after_fork`.
* Postgis adapter reports as Postgres for datastores

  The agent now maps the Postgis adapter to Postgres for datastore metrics. Thanks Vojtěch Vondra for the contribution!
* Deprecate `:trace_only` option

  The `NewRelic::Agent.notice_error` API has been updated to deprecate the `:trace_only` option in favor of `:expected`.
