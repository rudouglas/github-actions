---
subject: Node.js agent
releaseDate: '2019-02-11'
version: 5.3.0
---

### New features

* Added `span_events` and `transaction_segments` attribute destinations.

  Span event and segment attributes can now be filtered using the same include/exclude config rules as other types. See [agent attribute configuration](https://docs.newrelic.com/docs/agents/nodejs-agent/installation-configuration/nodejs-agent-configuration#node-js-attributes) for more details.
* Added `metadata` field to connect payload, for collecting `NEW_RELIC_METADATA_`-prefixed environment variables.
* Added DynamoDB to datastores.
* Added `opaque` option to datastore operation spec.
* Added Kubernetes utilization detection.
* Upgraded `concat-stream` and `readable-stream` to next major version.

  These modules had previously been held back due to support for Node &lt;6. Since v5.0.0 we dropped that support thus enabling these updates.
* Added SQS as a supported messaging library name.
* Enabled tracking of callback via `message-shim.recordConsume` when no messageHandler provided.

### Improvements

* Replaced `make` rules with npm scripts.

### Bug fixes

* The agent will now consistently harvest in all response cases when in serverless mode.

  Previously, the agent's harvest was in a race with process suspension in the event of an uncaught exception, or responding without calling a callback. A synchronous harvesting process is now used to circumvent this racing issue.
* Fixed issue with socket connection errors causing the agent to stop attempting to connect at startup.
* Fixed opaque segment functionality for `message-shim.recordProduce`.
* Fixed opaque segment functionality for `message-shim.recordConsume`.
