---
subject: Node.js agent
releaseDate: '2018-04-23'
version: 4.1.0
---

### Improvements

* Added PriorityQueue class for collecting events.

  This replaces the Reservoir class for event sampling. Using priority sampling allows the agent to maintain randomness across a given time period while improving the chances that events will be coordinated across Transaction, Error, and Custom event pools.
* The agent will now allow external instrumentation modules to fail in a safe way.

  Previously, the agent would stop running if an externally loaded instrumentation failed for any reason. Due to the way external instrumentations can be updated independently, the agent should allow them to fail and carry on after logging a warning.
* Added the `strip_exception_messages.enabled` config option.

  The agent can now be configured to redact error messages on collected errors.
* Added the `attributes.include_enabled` config option.

  The agent can now be configured to disallow attribute include patterns to be specified.

### Fixes.

* Updated logic around wrapping route handlers when `config` object is present.

  Before, the agent would only attempt to wrap `config.handler` when any `config` object was present, without defaulting to the root `handler` if it didn't exist.
