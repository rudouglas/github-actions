---
subject: Node.js agent
releaseDate: '2017-11-15'
version: 2.4.0
downloadLink: 'https://www.npmjs.com/package/newrelic'
---

### New features

* Instrumentation will now only modify the arity of wrapped functions when needed.

  This can be controlled with the `matchArity` property on a `WrapSpec`. Disabling arity matching has a significant, positive impact on the performance of instrumentation.

### Improvements

* Added benchmarks for shimmer methods.
* Pinned hapi tests at v16 due to incompatibility in hapi v17 with Node.js versions &lt;8.
* The agent's parsed queries will now only hold onto the stack that the query was made at, instead of an error object instance.

  Previously, the parsed query objects would hold onto an error instance, which would in turn hold onto references to all the functions in the stack when the error was created. This could cause memory issues if the functions were holding onto references to other pieces of data.

### Bug fixes

* Revert wrapping of `https` for Node `^8.9.1`.

  The original cause for this problem was reverted by Node.
